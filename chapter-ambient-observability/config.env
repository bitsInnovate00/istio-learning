# Feature Configuration for Istio Ambient Observability Stack
# This file controls optional features that can be enabled/disabled

# Apache APISIX API Gateway
# Set to 'true' to deploy APISIX alongside Istio for API management
# Set to 'false' to use only Istio Gateway
ENABLE_APISIX=false

# APISIX Configuration
APISIX_NAMESPACE=apisix
APISIX_REPLICAS=2
APISIX_ADMIN_KEY=edd1c9f034335f136f87ad84b625c8f1

# APISIX Dashboard
APISIX_DASHBOARD_ENABLED=true
APISIX_DASHBOARD_USERNAME=admin
APISIX_DASHBOARD_PASSWORD=admin

# APISIX Plugins (comma-separated)
# Available: prometheus,zipkin,key-auth,limit-count,cors,proxy-cache,request-id
APISIX_GLOBAL_PLUGINS="prometheus,request-id"

# Integration Settings
# Enable APISIX to participate in Istio ambient mesh
APISIX_AMBIENT_MODE=true

# Observability Integration
# Export APISIX metrics to Prometheus
APISIX_PROMETHEUS_EXPORT=true

# Export APISIX traces to Jaeger
APISIX_JAEGER_EXPORT=true
APISIX_JAEGER_ENDPOINT="http://jaeger-collector.istio-system.svc.cluster.local:9411/api/v2/spans"

# Traffic Management
# Route external traffic through APISIX or Istio Gateway
# Options: 'apisix', 'istio', 'both'
PRIMARY_GATEWAY=istio

# Default rate limiting (requests per minute)
DEFAULT_RATE_LIMIT=100

# API Authentication
# Enable API key authentication for /api/* endpoints
API_KEY_AUTH_ENABLED=true
DEFAULT_API_KEY=apikey-12345678901234567890

# Caching
# Enable response caching for static content
RESPONSE_CACHE_ENABLED=true
CACHE_TTL_SECONDS=3600

# Resource Limits
APISIX_CPU_REQUEST=500m
APISIX_CPU_LIMIT=2000m
APISIX_MEMORY_REQUEST=512Mi
APISIX_MEMORY_LIMIT=2Gi

# etcd Configuration
ETCD_REPLICAS=1
ETCD_STORAGE_SIZE=1Gi

# Logging
APISIX_LOG_LEVEL=warn
ENABLE_ACCESS_LOG=true

# Network
APISIX_HTTP_PORT=30800
APISIX_HTTPS_PORT=30443
APISIX_ADMIN_PORT=30180
APISIX_DASHBOARD_PORT=30900

# Health Checks
HEALTH_CHECK_INTERVAL=5
HEALTH_CHECK_TIMEOUT=3

# Feature Flags for Future Enhancements
# These are placeholders for additional features
ENABLE_SERVICE_CATALOG=false
ENABLE_API_DOCUMENTATION=false
ENABLE_OAUTH2=false
ENABLE_WAF=false

# Notes:
# - After changing this file, redeploy using: ./scripts/quick-start.sh --with-apisix
# - For production, change all default passwords and API keys
# - Adjust resource limits based on your workload
